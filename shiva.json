{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "title": "Shiva Pipeline Summary",
  "description": "Schema for full Shiva pipeline runs",
  "type": "object",
  "required": ["samples", "shiva"],

  "properties": {

    "meta": {
      "description": "Pipeline run metadata",
      "type": "object",

      "required": ["pipeline_version", "last_commit_hash", "pipeline_name"],

      "properties": {

        "pipeline_version": {
          "description": "Version of the pipeline",
          "type": "string"
        },

        "last_commit_hash": {
          "description": "Commit hash of the source code repository at the time the pipeline was compiled",
          "type": "string",
          "minLength": 7
        },

        "pipeline_name": {
          "description": "Name of the pipeline",
          "type": "string",
          "enum": ["shiva", "shivavariantcalling"]
        },

        "run_name": {
          "description": "User-supplied name of the pipeline run",
          "type": "string"
        },

        "output_dir": {
          "description": "Path to output directory of run"
          "type": "string"
        },

        "summary_creation": {
          "description": "Time of summary creation in Unix time",
          "type": "number"
        }
      }
    },

    "samples": {
      "description": "All samples analyzed in the Shiva run",
      "type": "object",
      "minItems": 1,
      "additionalProperties": {"$ref": "#/definitions/sample"}
    },

    "shiva": {
      "description": "Pipeline-level Shiva information",
      "type": "object",

      "properties": {

        "files": {
          "description": "Reference files used",
          "type": "object"
        },

        "executables": {
          "description": "Executables used",
          "type": "object",
          "additionalProperties": {
            "oneOf": [
              {"$ref": "#/definitions/executable"},
              {"$ref": "#/definitions/java_executable"}
            ]
          }
        }
      }

    }
  },

  "definitions": {

    "sample": {
      "description": "A shiva sample",
      "type": "object"
    },

    "executable": {
      "description": "A regular (i.e. non-java) executable",
      "type": "object",
      "required": ["path", "version", "md5"],
      "additionalProperties": false,

      "properties": {

        "path": {
          "description": "The path to the executable",
          "type": "string"
        },

        "version": {
          "description": "The version string of the executable",
          "type": ["string", "null"]
        },

        "md5": {
          "description": "The md5 checksum of the executable",
          "type": "string",
          "minLength": 32,
          "maxLength": 32,
          "pattern": "^[a-f0-9]{32}$"
        }
      }
    },

    "java_executable": {
      "description": "A java executable",
      "type": "object",
      "required": ["java_md5", "jar_path", "version", "java_version"],
      "additionalProperties": false,

      "properties": {

        "java_md5": {
          "description": "The md5 checksum of the JVM",
          "type": "string",
          "minLength": 32,
          "maxLength": 32,
          "pattern": "^[a-f0-9]{32}$"
        },

        "jar_path": {
          "description": "Path to the JAR",
          "type": ["string", "null"]
        },

        "version": {
          "description": "Version of the used JAR",
          "type": ["string", "null"]
        },

        "java version": {
          "description": "Version of the JVM",
          "type": ["string", "nu;;"]
        }
      }
    }
  }
}